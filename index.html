<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Book Check-In Scanner</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- html5-qrcode library -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <!-- Configuration -->
    <script src="config.js"></script>
</head>

<body>
    <div class="container">
        <!-- Login Page -->
        <div class="login-page" id="loginPage">
            <div class="login-card">
                <div class="login-header">
                    <h1>ðŸ“š Book Check-In</h1>
                    <p>Sign in to continue</p>
                </div>
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="loginIdentifier">Email or Username</label>
                        <input type="text" id="loginIdentifier" placeholder="Enter your email or username"
                            class="input-field" required autocomplete="username" />
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" class="input-field"
                            required autocomplete="current-password" />
                    </div>
                    <div class="login-error" id="loginError" style="display: none;"></div>
                    <button type="submit" class="btn btn-primary btn-full" id="loginBtn">
                        Sign In
                    </button>
                </form>
            </div>
        </div>

        <!-- Main App (hidden until logged in) -->
        <div class="main-app" id="mainApp" style="display: none;">
            <!-- Header -->
            <header class="header">
                <div class="header-content">
                    <h1 class="title">ðŸ“š Book Check-In</h1>
                    <p class="subtitle">Scan QR codes to process book returns</p>
                </div>
                <div class="header-actions">
                    <div class="user-info" id="userInfo"></div>
                    <button class="btn btn-secondary btn-sm" id="logoutBtn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Logout
                    </button>
                    <button class="settings-btn" id="settingsBtn" aria-label="Settings">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Settings Panel (only camera selection now) -->
            <div class="settings-panel" id="settingsPanel">
                <div class="settings-content">
                    <h3>Camera Settings</h3>
                    <div class="form-group">
                        <label for="cameraSelect">Camera</label>
                        <select id="cameraSelect" class="input-field">
                            <option value="">Select camera...</option>
                        </select>
                    </div>
                    <div class="settings-actions">
                        <button class="btn btn-secondary" id="cancelSettingsBtn">Close</button>
                        <button class="btn btn-primary" id="saveSettingsBtn">Save</button>
                    </div>
                </div>
            </div>

            <!-- Scanner Section -->
            <div class="scanner-section">
                <div class="scanner-wrapper" id="scannerWrapper">
                    <div id="qr-reader"></div>
                    <div class="scanner-overlay">
                        <div class="scan-frame"></div>
                    </div>
                </div>

                <div class="scanner-controls">
                    <button class="btn btn-primary" id="startScanBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M3 9a2 2 0 0 1 2-2h.93a2 2 0 0 0 1.664-.89l.812-1.22A2 2 0 0 1 10.07 4h3.86a2 2 0 0 1 1.664.89l.812 1.22A2 2 0 0 0 18.07 7H19a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z">
                            </path>
                            <circle cx="12" cy="13" r="3"></circle>
                        </svg>
                        Start Camera
                    </button>
                    <button class="btn btn-secondary" id="stopScanBtn" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="6" y="6" width="12" height="12"></rect>
                        </svg>
                        Stop Camera
                    </button>
                </div>

                <div class="scanner-controls" style="margin-top: 1rem;">
                    <button id="connectSessionBtn" class="btn btn-secondary">Connect to Session</button>
                </div>

                <div class="status-message" id="statusMessage">
                    Ready to scan. Click "Start Camera" to begin
                </div>
            </div>

            <!-- Result Section -->
            <div class="result-section" id="resultSection" style="display: none;">
                <div class="result-card">
                    <div class="result-icon" id="resultIcon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"></circle>
                            <path d="M8 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                            </path>
                        </svg>
                    </div>
                    <h3 id="resultTitle">Book Checked In Successfully</h3>
                    <div id="resultDetails" class="result-details"></div>
                    <button class="btn btn-primary" id="scanNextBtn">
                        Scan Next Book
                    </button>
                </div>
            </div>

            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                <div class="spinner"></div>
                <p>Processing check-in...</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="app.js"></script>
</body>

</html>